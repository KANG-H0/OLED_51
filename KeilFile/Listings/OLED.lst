C51 COMPILER V9.60.0.0   OLED                                                              07/15/2020 16:06:20 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE OLED
OBJECT MODULE PLACED IN .\Objects\OLED.obj
COMPILER INVOKED BY: D:\Keil\MDK\C51\BIN\C51.EXE ..\Code\OLED.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\List
                    -ings\OLED.lst) OBJECT(.\Objects\OLED.obj)

line level    source

   1          
   2          #include "OLED.h"
   3          #include "OLEDFont.h"
   4          
   5          /***OLED12864/0.96'/SSD1306***/
   6          
   7          /**
   8           * @description: 51å»¶æ—¶å‡½æ•° @11.0592MHz
   9           * @param {uint ms æ¯«ç§’} 
  10           * @return: void
  11           */
  12          void Delay_ms(uint ms)
  13          {
  14   1          uint j;
  15   1          for (ms; ms > 0;ms--)
  16   1              for (j = 112; j > 0;j--);
  17   1      }
  18          
  19          /**
  20           * @function: void OLED_Write_Byte(uchar WCommand,uchar cmdORdata)
  21           * @description: 
  22           * @param {uchar WDataå¾…å†™å…¥çš„å†…å®¹ï¼Œuchar cmdORdataæŒ‡æ˜å†™å…¥æŒ‡ä»¤è¿˜æ˜¯æ•°æ®} 
  23           * @return: void
  24           */
  25          void OLED_Write_Byte(uchar WData, uchar cmdORdata)
  26          {
  27   1          I2C_Start();
  28   1          I2C_Write_Byte(OLED_Addr + 0); //å†™å…¥å™¨ä»¶åœ°å€(bit0=1è¯»ï¼Œbit0=0å†™)
  29   1          I2C_Wait_Ack();
  30   1          I2C_Write_Byte(cmdORdata); //æŒ‡æ˜å†™å…¥æŒ‡ä»¤è¿˜æ˜¯æ•°æ®
  31   1          I2C_Wait_Ack();
  32   1          I2C_Write_Byte(WData); //å†™å…¥æ•°æ®å†…å®¹
  33   1          I2C_Wait_Ack();
  34   1          I2C_Stop();
  35   1      }
  36          
  37          /**
  38           * @function: void OLED_Fill(uchar Fill_Data)
  39           * @description: å…¨å±æ˜¾ç¤ºç›¸åŒæ•°æ®(ä¸»è¦ç”¨å»æ¸…å±)
  40           * @param {uchar Fill_Dataå¾…å…¨å±å†™å…¥çš„æ•°æ®} 
  41           * @return: void
  42           */
  43          void OLED_Fill(uchar Fill_Data)
  44          {
  45   1          uchar i, j;
  46   1          for (i = 0; i < 8; i++) //8é¡µï¼Œå…±éœ€è¦å¾ªç¯æ˜¾ç¤º8æ¬¡
  47   1          {
  48   2              OLED_Write_Byte(0xb0 + i, isCmd); //é¡µåœ°å€0~7
  49   2              OLED_Write_Byte(0x10, isCmd);     //è®¾ç½®é«˜ä½åˆ—åœ°å€
  50   2              OLED_Write_Byte(0x00, isCmd);     //è®¾ç½®ä½ä½åˆ—åœ°å€
  51   2              for (j = 0; j < OLED_Width; j++)  //æ¯é¡µæœ‰128åˆ—éœ€è¦æ˜¾ç¤º
  52   2                  OLED_Write_Byte(Fill_Data, isData);
  53   2          }
  54   1      }
C51 COMPILER V9.60.0.0   OLED                                                              07/15/2020 16:06:20 PAGE 2   

  55          
  56          /**
  57           * @function: void OLED_LocalFill(uchar x0, uchar y0, uchar x1, uchar y1, uchar LocalFill)
  58           * @description: å±€éƒ¨å†™ç›¸åŒæ•°æ®(ä¸»è¦ç”¨äºå±€éƒ¨æ¸…å±/äº®å±)
  59           * @param {uchar x0, uchar y0, uchar x1, uchar y1, uchar LocalFillï¼Œæ˜¾ç¤ºèµ·å§‹å’Œç»“æŸåæ ‡ï¼Œå†™å…¥æ
             -•°æ®} 
  60           * @return: void
  61           */
  62          #if 0
              void OLED_LocalFill(uchar x0, uchar y0, uchar x1, uchar y1, uchar LocalFill)
              {
                  uchar i, j;
                  for (i = y0; i <= y1; i++)
                  {
                      OLED_Set_Pos(x0, i);
                      for (j = x0; j < x1; j++)
                          OLED_Write_Byte(Fill_Data, isData);
                  }
              }
              #endif
  74          
  75          /**
  76           * @function: void OLED_Set_Pos(uchar x,uchar y)
  77           * @description: è®¾ç½®èµ·å§‹æ˜¾ç¤ºä½ç½®
  78           * @param {uchar xèµ·å§‹æ˜¾ç¤ºåˆ—0~127ã€uchar yèµ·å§‹æ˜¾ç¤ºé¡µ0~7} 
  79           * @return: void
  80           */
  81          void OLED_Set_Pos(uchar x, uchar y)
  82          {
  83   1          OLED_Write_Byte(0xb0 + y, isCmd);               //èµ·å§‹æ˜¾ç¤ºçš„é¡µ
  84   1          OLED_Write_Byte((x & 0xf0) >> 4 | 0x10, isCmd); //è®¾ç½®é«˜ä½åˆ—åœ°å€
  85   1          OLED_Write_Byte(x & 0x0f, isCmd);               //è®¾ç½®ä½ä½åˆ—åœ°å€
  86   1      }
  87          
  88          /**
  89           * @function: void OLED_Init()
  90           * @description: OLEDåˆå§‹åŒ–å‡½æ•°
  91           * @param {void} 
  92           * @return: void
  93           */
  94          void OLED_Init()
  95          {
  96   1          Delay_ms(200);
  97   1          OLED_Write_Byte(0xae, isCmd); //å…³é—­æ˜¾ç¤ºå™¨ display off
  98   1          OLED_Write_Byte(0x00, isCmd); //è®¾ç½®ä½ä½åˆ—åœ°å€ set low column address
  99   1          OLED_Write_Byte(0x10, isCmd); //è®¾ç½®é«˜ä½åˆ—åœ°å€ set high column address
 100   1          OLED_Write_Byte(0x40, isCmd); //è®¾ç½®èµ·å§‹è¡Œåœ°å€ set start line address
 101   1          OLED_Write_Byte(0xb0, isCmd); //è®¾ç½®é¡µåœ°å€ set page address
 102   1          OLED_Write_Byte(0x81, isCmd); //è®¾ç½®å¯¹æ¯”åº¦
 103   1          OLED_Write_Byte(0xff, isCmd); //å¯¹æ¯”åº¦,æ•°å€¼è¶Šå¤§å¯¹æ¯”åº¦è¶Šé«˜
 104   1          OLED_Write_Byte(0xa1, isCmd); //è®¾ç½®æ®µé‡æ–°æ˜ å°„ ä¸å·¦å³ç¿»è½¬set segment remap
 105   1          OLED_Write_Byte(0xa6, isCmd); //è®¾ç½®æ­£å¸¸/åå‘ normal / reverse
 106   1          OLED_Write_Byte(0xa8, isCmd); //è®¾ç½®å¤šè·¯å¤ç”¨æ¯”(1-64) set multiplex ratio(1 to 64)
 107   1          OLED_Write_Byte(0x3f, isCmd); //è®¾å®šå€¼1/32  1/32 duty
 108   1          OLED_Write_Byte(0xc8, isCmd); //æ‰«ææ–¹å‘ ä¸ä¸Šä¸‹ç¿»è½¬Com scan direction
 109   1      
 110   1          OLED_Write_Byte(0xd3, isCmd); //è®¾ç½®æ˜¾ç¤ºåç§» set display offset
 111   1          OLED_Write_Byte(0x00, isCmd); //
 112   1      
 113   1          OLED_Write_Byte(0xd5, isCmd); //è®¾ç½®oscåˆ†åŒº set osc division
 114   1          OLED_Write_Byte(0x80, isCmd); //
 115   1      
C51 COMPILER V9.60.0.0   OLED                                                              07/15/2020 16:06:20 PAGE 3   

 116   1          OLED_Write_Byte(0xd8, isCmd); //å…³é—­åŒºåŸŸé¢œè‰²æ¨¡å¼ set area color mode off
 117   1          OLED_Write_Byte(0x05, isCmd); //
 118   1      
 119   1          OLED_Write_Byte(0xd9, isCmd); //è®¾ç½®é¢„å……ç”µæœŸ Set Pre-Charge Period
 120   1          OLED_Write_Byte(0xf1, isCmd); //
 121   1      
 122   1          OLED_Write_Byte(0xda, isCmd); //è®¾ç½®comå¼•è„šé…ç½® set com pin configuartion
 123   1          OLED_Write_Byte(0x12, isCmd); //
 124   1      
 125   1          OLED_Write_Byte(0xdb, isCmd); //è®¾ç½®vcomh set Vcomh
 126   1          OLED_Write_Byte(0x30, isCmd); //
 127   1      
 128   1          OLED_Write_Byte(0x8d, isCmd); //è®¾ç½®ç”µæºæ³µå¯ç”¨ set charge pump enable
 129   1          OLED_Write_Byte(0x14, isCmd); //
 130   1      
 131   1          OLED_Write_Byte(0xa4, isCmd); //è®¾ç½®å…¨å±€æ˜¾ç¤ºå¼€å¯ï¼›bit0ï¼Œ1å¼€å¯ï¼Œ0å…³é—­(ç™½å±/é»‘å±)
 132   1          OLED_Write_Byte(0xa6, isCmd); //è®¾ç½®æ˜¾ç¤ºæ–¹å¼ï¼Œbit0ï¼Œ1åç›¸æ˜¾ç¤ºï¼Œ0æ­£å¸¸æ˜¾ç¤º
 133   1      
 134   1          OLED_Write_Byte(0xaf, isCmd); //æ‰“å¼€oledé¢æ¿ turn on oled panel
 135   1      
 136   1          OLED_Fill(0x00); //æ¸…å±
 137   1      }
 138          
 139          /**
 140           * @function: void OLED_DisplayChar(uchar x, uchar y, uchar DisplayChar, uchar TextSize)
 141           * @description: åœ¨OLED12864ç‰¹å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦
 142           * @param {uchar xåˆ—, uchar yè¡Œ, uchar DisplayCharæ˜¾ç¤ºçš„å­—ç¬¦, uchar TextSizeå­—ä½“å¤§å°} 
 143           * @return: void
 144           */
 145          void OLED_DisplayChar(uchar x, uchar y, uchar DisplayChar, uchar TextSize)
 146          {
 147   1          uchar c = 0, i;
 148   1          c = DisplayChar - 32; //ç­‰åŒäºå‡å»ä¸ªç©ºæ ¼c = DisplayChar - ' '; å¾—åˆ°æ˜¾ç¤ºå­—ç¬¦åœ¨åº“ä¸­çš„å
             -ç§»åœ°å€
 149   1          switch (TextSize)
 150   1          {
 151   2          case 1:
 152   2              OLED_Set_Pos(x, y); //å¼€å§‹æ˜¾ç¤ºä½ç½®
 153   2              for (i = 0; i < 6; i++)
 154   2                  OLED_Write_Byte(F6X8[c][i], isData); //æ˜¾ç¤ºä¸€ä¸ª6X8å­—ç¬¦
 155   2              break;
 156   2          case 2:
 157   2              OLED_Set_Pos(x, y);                                 //å¼€å§‹æ˜¾ç¤ºä½ç½®
 158   2              for (i = 0; i < 8; i++)                             //æ˜¾ç¤ºä¸€ä¸ª8X16å­—ç¬¦çš„ä¸ŠåŠéƒ¨åˆ†
 159   2                  OLED_Write_Byte(F8X16[c * 16 + i], isData);     //å¾ªç¯æ˜¾ç¤ºæ•°ç»„ä¸­å‰8ä¸ªæ•°æ®
 160   2              OLED_Set_Pos(x, y + 1);                             //æ¢åˆ°ä¸‹ä¸€é¡µï¼Œæ˜¾ç¤ºå­—ç¬¦ä¸‹åŠéƒ¨åˆ†
 161   2              for (i = 0; i < 8; i++)                             //æ˜¾ç¤º8X16å­—ç¬¦çš„ä¸‹åŠéƒ¨åˆ†
 162   2                  OLED_Write_Byte(F8X16[c * 16 + i + 8], isData); //å¾ªç¯æ˜¾ç¤ºæ•°ç»„ä¸­å8ä¸ªæ•°æ®
 163   2              break;
 164   2          }
 165   1      }
 166          
 167          /**
 168           * @function: void OLED_DisplayStr(uchar x, uchar y, uchar *DisplayStr, uchar TextSize)
 169           * @description: åœ¨OLED12864ç‰¹å®šä½ç½®æ˜¾ç¤ºå­—ç¬¦ä¸²
 170           * @param {uchar xåˆ—, uchar yè¡Œ, uchar *DisplayStrå¾…æ˜¾ç¤ºçš„å­—ç¬¦ä¸², uchar TextSizeå­—ä½“å¤§å°} 
 171           * @return: void
 172           */
 173          void OLED_DisplayStr(uchar x, uchar y, uchar *DisplayStr, uchar TextSize) //(uchar *DisplayStr)æ”¹æˆ(ucha
             -r DisplayStr[])ä¹Ÿå¯
 174          {
 175   1          uchar j = 0;
C51 COMPILER V9.60.0.0   OLED                                                              07/15/2020 16:06:20 PAGE 4   

 176   1          while (DisplayStr[j] != '\0') //åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æ˜¾ç¤ºå®Œæˆ
 177   1          {
 178   2              OLED_DisplayChar(x, y, DisplayStr[j], TextSize);
 179   2              if (TextSize == 1) //6X8çš„å­—ä½“åˆ—åŠ 6ï¼Œæ˜¾ç¤ºä¸‹ä¸€ä¸ªå­—ç¬¦
 180   2                  x += 6;
 181   2              else if (TextSize == 2) //8X16çš„å­—ä½“åˆ—åŠ 8ï¼Œæ˜¾ç¤ºä¸‹ä¸€ä¸ªå­—ç¬¦
 182   2                  x += 8;
 183   2      
 184   2              if (x > 122 && TextSize == 1) //TextSize6x8å¦‚æœä¸€è¡Œä¸å¤Ÿæ˜¾ç¤ºäº†ï¼Œä»ä¸‹ä¸€è¡Œç»§ç»­æ˜¾ç¤º
 185   2              {
 186   3                  x = 0;
 187   3                  y++;
 188   3              }
 189   2              if (x > 120 && TextSize == 2) //TextSize8x16å¦‚æœä¸€è¡Œä¸å¤Ÿæ˜¾ç¤ºäº†ï¼Œä»ä¸‹ä¸€è¡Œç»§ç»­æ˜¾ç¤º
 190   2              {
 191   3                  x = 0;
 192   3                  y++;
 193   3              }
 194   2              j++;
 195   2          }
 196   1      }
 197          
 198          /**
 199           * @function: void OLED_DisplayCN(uchar x, uchar y, uchar Num)
 200           * @description: åœ¨OLED12864ç‰¹å®šä½ç½®æ˜¾ç¤º16X16æ±‰å­—
 201           * @param {uchar xåˆ—, uchar yè¡Œ, uchar Noæ±‰å­—åº“ä¸­æ±‰å­—ç¼–å·} 
 202           * @return: void
 203           */
 204          void OLED_DisplayCN(uchar x, uchar y, uchar Num)
 205          {
 206   1          uchar i;
 207   1          OLED_Set_Pos(x, y);
 208   1          for (i = 0; i < 16; i++)
 209   1              OLED_Write_Byte(FontCN[2 * Num][i], isData); //æ˜¾ç¤ºæ±‰å­—çš„ä¸ŠåŠéƒ¨åˆ†
 210   1          OLED_Set_Pos(x, y + 1);
 211   1          for (i = 0; i < 16; i++)
 212   1              OLED_Write_Byte(FontCN[2 * Num + 1][i], isData); //æ˜¾ç¤ºæ±‰å­—çš„ä¸‹åŠéƒ¨åˆ†
 213   1      }
 214          
 215          /**
 216           * @function: void OLED_DisplayBMP(uchar x0, uchar y0, uchar x1, uchar y1, uchar *BMP)
 217           * @description: åœ¨OLED12864ç‰¹å®šä½ç½®æ˜¾ç¤ºBMPå›¾ç‰‡
 218           * @param {uchar x0,uchar y0(x0,y0æ˜¾ç¤ºèµ·ç‚¹åæ ‡x:0~127,y0:0~7)ã€uchar x1,uchar y1(x1,y1æ˜¾ç¤ºç»“æŸå
             -æ ‡x0:0~127,y0:0~7)ã€uchar *BMPå¾…æ˜¾ç¤ºçš„å›¾ç‰‡æ•°æ®} 
 219           * @return: void
 220           */
 221          #if 0
              void OLED_DisplayBMP(uchar x0, uchar y0, uchar x1, uchar y1, uchar *BMP)
              {
                  uint j = 0;
                  uchar x, y;
                  if (y1 % 8 == 0) //ç”¨äºç¡®å®šæ˜¾ç¤ºå‡ é¡µ
                      y = y1 / 8;
                  else
                      y = y1 / 8 + 1;
                  for (y = y0; y < y1; y++) //ä»è®¾ç½®çš„èµ·å§‹é¡µå¼€å§‹æ˜¾ç¤ºåˆ°ç»“æŸé¡µ
                  {
                      OLED_Set_Pos(x0, y);                   //è¿›å…¥ä¸‹ä¸€é¡µæ˜¾ç¤ºèµ·å§‹ä½ç½®
                      for (x = x0; x < x1; x++)              //ä»è®¾ç½®å¼€å§‹åˆ—æ˜¾ç¤ºåˆ°ç»“æŸåˆ—
                          OLED_Write_Byte(BMP[j++], isData); //é€ä¸ªä¼ å…¥æ˜¾ç¤ºæ•°æ®
                  }
              }
C51 COMPILER V9.60.0.0   OLED                                                              07/15/2020 16:06:20 PAGE 5   

              #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    786    ----
   CONSTANT SIZE    =   2392    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      23
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
